"""
Base Feature Engineering Class
Abstract base class for all feature generators
"""

from abc import ABC, abstractmethod
from typing import Any, Dict, List
import pandas as pd
from loguru import logger


class BaseFeatureGenerator(ABC):
    """Abstract base class for feature generators"""

    def __init__(self, feature_version: str = "v1.0"):
        """
        Initialize base feature generator

        Args:
            feature_version: Version identifier for features
        """
        self.feature_version = feature_version
        self.feature_names: List[str] = []

    @abstractmethod
    def generate(self, df: pd.DataFrame) -> pd.DataFrame:
        """
        Generate features from input DataFrame

        Args:
            df: Input DataFrame

        Returns:
            DataFrame with generated features
        """
        pass

    @abstractmethod
    def get_feature_names(self) -> List[str]:
        """
        Get list of feature names generated by this generator

        Returns:
            List of feature names
        """
        pass

    def validate_input(self, df: pd.DataFrame, required_columns: List[str]) -> bool:
        """
        Validate input DataFrame has required columns

        Args:
            df: DataFrame to validate
            required_columns: List of required column names

        Returns:
            True if valid, False otherwise
        """
        missing_columns = [col for col in required_columns if col not in df.columns]

        if missing_columns:
            logger.error(f"Missing required columns: {missing_columns}")
            return False

        return True

    def get_metadata(self) -> Dict[str, Any]:
        """
        Get metadata about the feature generator

        Returns:
            Dictionary with metadata
        """
        return {
            "generator_class": self.__class__.__name__,
            "feature_version": self.feature_version,
            "num_features": len(self.feature_names),
            "feature_names": self.feature_names,
        }

    def log_generation_summary(self, df: pd.DataFrame, original_cols: int) -> None:
        """
        Log summary of feature generation

        Args:
            df: DataFrame after feature generation
            original_cols: Number of columns before generation
        """
        new_cols = len(df.columns) - original_cols
        logger.info(f"{self.__class__.__name__} generated {new_cols} new features")
        logger.debug(f"Total columns: {len(df.columns)}, New features: {self.feature_names}")
